#!/bin/sh

index=$(cat <<END
2018:
Web;
src/web/separation-of-concerns.md
src/web/instapaper-without-javascript.md
src/english/texts/replacing-javascript/
OpenBSD;
src/openbsd/installation.md
src/openbsd/browser-refresh-on-save.md
END)

list=$(echo "$index" | while read line; do
	if [ $(echo "$line" | grep ':$') ]; then
		echo "<h2>${line%:}</h2>" # year
	elif [ $(echo "$line" | grep ';$') ]; then
		echo "<h3>${line%;}</h3>" # topic
	else
		file="$line"
		[ "${file%/}" = "$file" ] || file="${line}index.html"
		title=$(head -n 3 "$file" | tail -n 1)
		title="${title#\# }"
		url="${line#src/}"
		[ "${url%.md}" = "$url" ] || url="${url%.md}.html"
		cat <<END
<li><a href="$url">$title</a></li>
END
	fi
done)

content=$(cat <<END
<ul>
$list
</ul>
END)

export lang title author content
content=$(bin/html-index-tpl)
bin/html-page-tpl
