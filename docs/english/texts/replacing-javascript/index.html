<!--
2018-01-12T07:00:00+01:00
Replacing JavaScript

en
-->
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Let&rsquo;s Replace JavaScript with Something Better</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="John AnkarstrÃ¶m" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="../document.css" type="text/css" />
<script src="../document.js" type="text/javascript"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Let&rsquo;s Replace JavaScript with Something Better</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#introduction">Abstract and introduction</a></li>
<li><a href="#interface-design">Designing the interface</a>
<ul>
<li><a href="#separating-good-from-evil">Separating good from evil</a></li>
<li><a href="#goals-and-principles">Fundamental goals and principles</a></li>
</ul>
</li>
<li><a href="#dynamic-http-requests">Dynamic HTTP requests</a>
<ul>
<li><a href="#inspiration">Inspiration: <i>Intercooler</i></a>
<ul>
<li><a href="#orga4016f4">Events that trigger requests</a></li>
<li><a href="#org54018be">Posting data</a></li>
<li><a href="#orgf13c49d">Handling the response</a></li>
<li><a href="#org86e0f08">Getting inspired</a></li>
</ul>
</li>
<li><a href="#automatic-http-requests">Automatically updating a page</a></li>
<li><a href="#http-request-examples">Examples (with possible syntax)</a></li>
</ul>
</li>
<li><a href="#dynamic-css-rules">Dynamic CSS rules</a>
<ul>
<li><a href="#org1b58a04">Inspiration: <i>Prolog</i></a></li>
<li><a href="#css-examples">Examples (with possible syntax)</a></li>
</ul>
</li>
<li><a href="#orgaa71b80">Dynamic DOM manipulation</a></li>
<li><a href="#org7d33139">In closing: <span class="heading-sub">   Reason for optimism </span>  </a>
<ul>
<li><a href="#orgf21330d">Changelog</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgdb1bbe5" class="outline-2">
<h2 id="introduction"><a id="orgdb1bbe5"></a>Abstract and introduction</h2>
<div class="outline-text-2" id="text-introduction">
<p>
<b>In light of the Meltdown and Spectre bugs</b>, which allow ill-willed programs
access to restricted parts of the computer&rsquo;s memory, it is time to re-evaluate
the position of JavaScript in the holy trinity of front-end development.
</p>

<p>
JavaScript always was a bad idea, for the simple fact that automatically
executing untrusted code from untrusted and unknown sources is a bad idea. Even
though the Meltdown and Spectre bugs are no direct fault of JavaScript, it is
the only front-end language on the web through which the bugs are exploitable.
The fact that the vast majority of JavaScript is non-free software, executed
without the user&rsquo;s knowledge, makes the bugs more dangerous than they would
otherwise be.
</p>

<p>
Furthermore, even without the bugs, JavaScript is increasingly being used in
ways that are fundamentally user-hostile &#x2013; ranging from The Pirate Bay&rsquo;s
non-consensual cryptocurrency mining to advertising companies&rsquo; intrusive
tracking of users across the web.
</p>

<p>
<b>This article argues that JavaScript</b> needs to be replaced with a safer
alternative, built to provide all the user-friendly functionality of JavaScript,
but constructed in a way that makes user-hostile practices impossible &#x2013; and,
finally and crucially, designed to be <i>opt-in</i>.
</p>

<p>
In addition to making the web safer and more user-friendly, this represents an
opportunity to make front-end development more streamlined. In the company of
the two declarative languages HTML and CSS, the imperative, all-purpose
JavaScript always seemed the odd one out. This is a chance to design a new
standard, inspired by the declarative nature of HTML and CSS, providing the
desirable and user-friendly functions of JavaScript, while leaving out the
dangerous parts &#x2013; all through a much more pleasant interface.
</p>

<p>
This article presents one possible solution, in the form of two separate
extensions to HTML and CSS respectively. At the same time, it recognizes that it
will take much time and effort to come up with an ideal interface, capable of
replacing JavaScript. Right now, however, the most important thing is presenting
the idea and spreading it.
</p>

<div class="note">
<p>
If you sympathize with the message of this article, please consider contributing
by spreading the idea on the internet, even if you disagree with my specific
implementation proposals.
</p>

<p>
I&rsquo;d love to discuss the ideas on Hacker News or Reddit.
</p>

<p>
Thanks!
</p>

</div>
</div>
</div>


<div id="outline-container-org681ed3d" class="outline-2">
<h2 id="interface-design"><a id="org681ed3d"></a>Designing the interface</h2>
<div class="outline-text-2" id="text-interface-design">
</div>

<div id="outline-container-orgc0650f4" class="outline-3">
<h3 id="separating-good-from-evil"><a id="orgc0650f4"></a>Separating good from evil</h3>
<div class="outline-text-3" id="text-separating-good-from-evil">
<p>
In the design of this new, declarative interface, we need to consider both the
good and the bad sides of JavaScript.
</p>

<p>
JavaScript is a wonderful tool for providing a dynamic way of interacting with a
webpage. It is great for changing the style of a page on the fly, for crafting
dynamic menus and forms and for updating the page without having to refresh &#x2013;
all in all, it is an indispensible cornerstone of useful web apps.
</p>

<p>
But there&rsquo;s a catch. Above all, what&rsquo;s dangerous about JavaScript is that it is
executed <b>without the user&rsquo;s knowledge or consent</b>. Sure, web developers are aware
of it and, one might argue, consent to it by not disabling JavaScript, but the
vast majority of users have little to no knowledge of the JavaScript being
executed on their machines.
</p>

<p>
Another big problem are AJAX requests, which likewise often occur without
knowledge or consent &#x2013; potentially sending private, personal information to
third parties, or (like certain online newspapers) draining the user&rsquo;s bandwidth
by downloading gigabytes of media in the background.
</p>

<p>
Even for the developer, JavaScript isn&rsquo;t a particularily pleasant interface for
the things it is designed for. It is constantly upheld as an example of a messy
and inconsistent language, so hard to work with that people have developed
<i>several</i> languages &#x2013; CoffeeScript, TypeScript, ClojureScript et al. &#x2013; that
compile to JavaScript, all to avoid actually using JavaScript.
</p>

<p>
JavaScript is also weird because it is imperative, forcing the programmer to
describe the means in which to achieve the desired result, instead of
declaratively describing the desired result itself, like in HTML and CSS.
</p>

<p>
Any interface looking to replace JavaScript must try to retain as many of the
good parts as possible, while removing the bad parts. This might sound like a
difficult task &#x2013; and it is &#x2013; but, as this article will show, it is not
impossible. In fact, it is perfectly realizable.
</p>

<p>
To be clear, what is being presented is not a programming language &#x2013; it is only
the idea of an interface, that <i>might</i> be implemented in the form of a separate
language, or perhaps simply as a series of extensions to HTML and CSS.
</p>
</div>
</div>

<div id="outline-container-org5746add" class="outline-3">
<h3 id="goals-and-principles"><a id="org5746add"></a>Fundamental goals and principles</h3>
<div class="outline-text-3" id="text-goals-and-principles">
<p>
The <i>good parts</i> of JavaScript listed above can be summarized into three pieces of
fundamental functionality:
</p>

<ol class="org-ol">
<li>Dynamic HTTP requests (AJAX)</li>
<li>Dynamic DOM manipulation</li>
<li>Dynamic CSS rules</li>
</ol>

<p>
These three goals would need to be met by any serious JavaScript replacement.
Moreover, <i>our</i> interface would have to meet them while avoiding any of the <i>bad
parts</i>. The two latter pieces of functionality &#x2013; dynamic generation of local
HTML and CSS &#x2013; cannot be particularily harmful to the user, but, <a href="#separating-good-from-evil">as exemplified
earlier</a>, AJAX requests <i>can</i> be.
</p>

<p>
For this reason, the design of the interface for dynamic HTTP requests must be
dictated by a <b>principle of user consent</b>.
</p>
</div>
</div>
</div>


<div id="outline-container-org15f5771" class="outline-2">
<h2 id="dynamic-http-requests"><a id="org15f5771"></a>Dynamic HTTP requests</h2>
<div class="outline-text-2" id="text-dynamic-http-requests">
<p>
As mentioned above, AJAX is an important foundation on which modern web apps are
built, but while it can be used for minimizing load times and saving the user&rsquo;s
bandwidth, it can also be abused in user-hostile ways.
</p>

<p>
Again, this is why the replacement for AJAX must be built on consent. The goal
is to provide the same functionality &#x2013; like dynamically posting form data to
the server or retrieving HTML from an external source &#x2013; but in a way such that
it is impossible to achieve without the user&rsquo;s consent.
</p>

<p>
In order to adhere to this principle, sites using the proposed interface would
only be able to make dynamic requests as a result of a few defined events, that
always occur with the user&rsquo;s knowledge and permission. This means that no
requests should be made without the user&rsquo;s explicit initiation (for example, by
clicking a button or pressing a key). If you&rsquo;re wondering how this is compatible
with web apps that rely on automatic updates, that issue is solved in <a href="#automatic-http-requests">a later
section</a>.
</p>

<p>
In the design of this interface, there are many specific issues that need to be
tackled, but first, let&rsquo;s look at a possible way to implement the more general
functionality.
</p>
</div>

<div id="outline-container-org306c98b" class="outline-3">
<h3 id="inspiration"><a id="org306c98b"></a>Inspiration: <i>Intercooler</i></h3>
<div class="outline-text-3" id="text-inspiration">
<p>
The JavaScript framework <i><a href="http://intercoolerjs.org/">Intercooler</a></i> is an interesting project, much because of
the philosophical foundation behind it (see <a href="http://intercoolerjs.org/2016/01/18/rescuing-rest.html">this</a> and <a href="http://intercoolerjs.org/2016/05/08/hatoeas-is-for-humans.html">this</a>). With a few
modifications, it turns out to be very compatible with the ideas presented in
this article.
</p>

<p>
Most importantly, the framework extends HTML with this collection of attributes:
</p>

<ul class="org-ul">
<li><code>ic-get-from</code></li>
<li><code>ic-post-to</code></li>
<li><code>ic-put-to</code></li>
<li><code>ic-patch-to</code></li>
<li><code>ic-delete-from</code></li>
</ul>

<p>
When put on an HTML element, these attributes describe the sort of HTTP request
for that element to trigger, and their values describe where to direct that
request.
</p>

<p>
It is easy to see how this would be useful for own ideas about user consent:
when the user hovers over an HTML element with one of these attributes, the web
browser would display a tooltip warning the user about the attached request.
</p>
</div>

<div id="outline-container-orga4016f4" class="outline-4">
<h4 id="orga4016f4">Events that trigger requests</h4>
<div class="outline-text-4" id="text-orga4016f4">
<p>
Such a request is trigged when the element is subjected to a specific DOM event.
The default for most elements is the <code>click</code> event, except for elements designed
for keyboard input from the user, which are trigged by the <code>change</code> event per
default.
</p>

<p>
There is a long list of further events that can serve as triggers, but <code>click</code> and
<code>change</code> are the only events that are compatible with our principle of user
consent. For any other events, such as those depending on mouse movement or
scrolling, there is no obvious way for the browser to non-intrusively inform the
user of the dynamic request before it is made.
</p>
</div>
</div>

<div id="outline-container-org54018be" class="outline-4">
<h4 id="org54018be">Posting data</h4>
<div class="outline-text-4" id="text-org54018be">
<p>
Including form data in the request is simple. By default, <i>Intercooler</i> will
include a serialized representation of the nearest parent form, relative to the
triggering element. Additionally, the <code>ic-include</code> attribute allows the developer
to specify through a jQuery selector (very similar to CSS selectors) an
arbitrary element to be serialized and included in the request.
</p>
</div>
</div>

<div id="outline-container-orgf13c49d" class="outline-4">
<h4 id="orgf13c49d">Handling the response</h4>
<div class="outline-text-4" id="text-orgf13c49d">
<p>
As explained in the <a href="http://intercoolerjs.org/docs.html"><i>Intercooler</i> documentation</a>, the server to which the HTTP
request is made returns a response in the form of HTML. According to the default
behavior, <i>Intercooler</i> then replaces the element triggering the request with the
HTML response. Through the <code>ic-target</code> attribute, the response can be configured
to be put into some other element.
</p>
</div>
</div>

<div id="outline-container-org86e0f08" class="outline-4">
<h4 id="org86e0f08">Getting inspired</h4>
<div class="outline-text-4" id="text-org86e0f08">
<p>
<i>Intercooler</i> also implements an <code>ic-poll</code> attribute, through which the programmer
can repeat the request on a timer. Also this is a potential source of
inspiration when we attempt to make our AJAX replacement compatible with
automatically repeated AJAX requests.
</p>

<p>
As you will see in this section, only a small number of changes would be needed
in order to make the <i>Intercooler</i> interface compatible with our own ideas about
user consent.
</p>
</div>
</div>
</div>

<div id="outline-container-org0b1a433" class="outline-3">
<h3 id="automatic-http-requests"><a id="org0b1a433"></a>Automatically updating a page</h3>
<div class="outline-text-3" id="text-automatic-http-requests">
<p>
The notion of automatically and dynamically updating the content of a webpage
seems to go against the notion of user consent, but if we imagine that the
interface proposed in this article would replace JavaScript completely, then
removing the ability to automatically make repeated HTTP requests would
seriously limit the usefulness of modern web apps &#x2013; just imagine a web-based
instant messaging app without automatic updates!
</p>

<p>
Fortunately, this problem can clearly and easily be solved by designing a
<b>standardized API</b> for automatic updates, implemented by the web browsers, much
like they have all implemented the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API">Notifications API</a>.
</p>

<p>
Just like the notifications, automatically repeated HTTP requests would be
opt-in; this makes them fully compatible with the principle of user consent. Of
course, just like notifications, the user&rsquo;s choice for each site could
optionally be remembered by the browser.
</p>

<p>
This would mean a web where users wouldn&rsquo;t have to worry that their news site
silently downloads gigabytes in the background, while their favorite web-based
messaging service would work without any manual refresh.
</p>

<p>
When a user visits their favorite social network, their browser would present
them with a dialog box, asking them whether to allow the webpage to make
repeated HTTP requests in the background. The dialog box would inform the user
of what type of request the page wants to make, to which address it would be
made and, if applicable, what information (form data, for example) the request
would include.
</p>

<p>
(For an interface based on <i>Intercooler</i>, another good idea would be for the
dialog box, when hovered above, to highlight the element into which the response
would be put.)
</p>

<p>
For an idea of what this dialog box would look like, compare the current dialog
box for the Notifications API in Firefox:
</p>


<div id="orgbc80466" class="figure">
<p><img src="./notifications-api.png" alt="notifications-api.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orge33ad38" class="outline-3">
<h3 id="http-request-examples"><a id="orge33ad38"></a>Examples (with possible syntax)</h3>
<div class="outline-text-3" id="text-http-request-examples">
<p>
Let&rsquo;s put our theory into practice and take a look at what an interface for
dynamic HTTP requests could look like.
</p>

<p>
With <i>Intercooler</i> as inspiration, HTML could be extended with the following
attributes:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Attributes</th>
<th scope="col" class="org-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>get</code>, <code>post</code>, <code>put</code>, <code>patch</code>, <code>delete</code></td>
<td class="org-left">Each attribute describes the type of HTTP request, and its value specifies the destination. Elements with any of these attributes display a tooltip, warning about the request, when hovered above.</td>
</tr>

<tr>
<td class="org-left"><code>trigger-on</code></td>
<td class="org-left">Based on the <code>ic-trigger-on</code> attribute, describing what event should trigger the request, but supporting only the <code>click</code> and <code>change</code> events.</td>
</tr>

<tr>
<td class="org-left"><code>include</code></td>
<td class="org-left">A partial implementation of <code>ic-include</code>, specifying through a CSS selector an HTML element to be serialized and included in the request.</td>
</tr>

<tr>
<td class="org-left"><code>prepend</code>, <code>replace</code>, <code>append</code></td>
<td class="org-left">All based on <code>ic-target</code>, but describing more precisely where to put the output of the request, using a CSS selector.</td>
</tr>

<tr>
<td class="org-left"><code>poll</code></td>
<td class="org-left">Attempts to register an automatically repeated request, via a standardized API for automatic updates. The value specifies the interval.</td>
</tr>
</tbody>
</table>

<p>
The interface would be used in the following way:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #006699;">a</span> <span style="color: #BA36A5;">get</span>=<span style="color: #008000;">"/status-updates"</span> <span style="color: #BA36A5;">prepend</span>=<span style="color: #008000;">"#status-feed"</span> <span style="color: #BA36A5;">poll</span>=<span style="color: #008000;">"2s"</span>&gt;
  Update status feed
&lt;/<span style="color: #006699;">a</span>&gt;
&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"status-feed"</span>&gt;
  <span style="color: #8D8D84;">&lt;!-- </span><span style="color: #8D8D84; font-style: italic;">Old status updates </span><span style="color: #8D8D84;">--&gt;</span>
&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<p>
As you can see, such an extension of HTML goes a long way. Implementing this
small number of attributes is likely sufficient for replacing AJAX in a majority
of the cases. For some people, it does require a new way of thinking &#x2013; but as
explained on the <i>Intercooler</i> homepage, this might actually be a <i>better</i> way of
thinking, more compatible with the philosophy of REST and, incidentally, that of
HTML itself.
</p>

<p>
That is: not only would this extension to HTML be a replacement for AJAX that is
safer, more trustworthy and more user-friendly &#x2013; it would be developer-friendly
as well, because it goes <i>with</i> the grain of the web, unlike JavaScript, which has
always gone against it.
</p>

<p>
Before we move on, I should say that it is also worth looking at the
<a href="http://intercoolerjs.org/docs.html#history"><i>Intercooler</i> interface to the History API</a> as a future source of inspiration.
</p>
</div>
</div>
</div>

<div id="outline-container-org0017cf1" class="outline-2">
<h2 id="dynamic-css-rules"><a id="org0017cf1"></a>Dynamic CSS rules</h2>
<div class="outline-text-2" id="text-dynamic-css-rules">
<p>
The second goal of this article is to propose an interface for dynamic CSS rules
&#x2013; a common area of use for JavaScript. Modern dynamic web pages need a way to
connect the click of a button, or the hovering over an element, to a change in
the CSS stylesheet.
</p>

<p>
It is not obvious how to solve this problem. First, there is the issue of <i>where</i>
to solve it &#x2013; in CSS, in HTML or in an entirely new language?
</p>

<p>
In analogy with the proposed solution for <a href="#dynamic-http-requests">AJAX without the J</a> in the form of an
extension to HTML, I propose that the solution for dynamic CSS &ldquo;without the J&rdquo;
would best be an extension to CSS itself.
</p>
</div>

<div id="outline-container-org1b58a04" class="outline-3">
<h3 id="org1b58a04">Inspiration: <i>Prolog</i></h3>
<div class="outline-text-3" id="text-org1b58a04">
<p>
I know, I know! What does <i>Prolog</i> have to do with CSS? How could it possibly
serve as inspiration for our interface? I will explain.
</p>

<p>
The truth is that, unlike those that extend HTML, it is quite difficult to find
JavaScript projects that aim to extend CSS in a dynamic way. Perhaps this is
because HTML is more obviously extensible, thanks to its XML-like syntax, but
whatever the reason may be, this leaves us with little inspiration for our own
extension to CSS.
</p>

<p>
We have to find it elsewhere &#x2013; so let us think about what we need to implement,
and whether there are any similar projects we can think of and be inspired by.
</p>

<p>
An important insight is the need for <i>conditional</i> CSS rules. If we could write a
rule, but stipulate that it only be applied under a certain condition, we could
eliminate much of the need for JavaScript.
</p>

<p>
This is where Prolog comes into the picture. It is a logic programming language
that is practically <i>built</i> upon conditions. The following code describes <i>under
which conditions</i> that the relationship between a grandparent and a grandchild
holds:
</p>

<div class="org-src-container">
<pre class="src src-prolog"><span style="color: #006699;">grandparent_grandchild</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">Grandparent</span>, <span style="color: #BA36A5;">Grandchild</span><span style="color: #707183;">)</span> :-
  parent_child<span style="color: #707183;">(</span><span style="color: #BA36A5;">Grandparent</span>, <span style="color: #BA36A5;">Parent</span><span style="color: #707183;">)</span>,
  parent_child<span style="color: #707183;">(</span><span style="color: #BA36A5;">Parent</span>, <span style="color: #BA36A5;">Grandchild</span><span style="color: #707183;">)</span>.
</pre>
</div>

<p>
That reads: the relation &ldquo;grandparent-grandchild&rdquo; holds for any <i>Grandparent</i> and
<i>Grandchild</i> &#x2013; <b>if</b> the relation &ldquo;parent-child&rdquo; holds for that <i>Grandparent</i> and some
<i>Parent</i> <b>and</b> the &ldquo;parent-child&rdquo; relation also holds for that same <i>Parent</i> and the
<i>Grandchild</i>.
</p>

<p>
Imagine if we could do the same with CSS: to stipulate, for example, that the
rule <code>#menu { display: block; }</code> be applied when <code>#menu-button:hover</code> is true. Such
simple conditions don&rsquo;t really require any Prolog-like implementation, but what
about more advanced conditions?
</p>

<p>
As an example, let&rsquo;s take this very page.
</p>
</div>
</div>

<div id="outline-container-orgec09619" class="outline-3">
<h3 id="css-examples"><a id="orgec09619"></a>Examples (with possible syntax)</h3>
<div class="outline-text-3" id="text-css-examples">
<p>
Let&rsquo;s take a piece of JavaScript code and convert it to CSS, extended with a
plausible (but by no means set in stone) syntax. The following JavaScript is a
sample from this webpage, highlighting the current section in the Table of
Contents as the user scrolls through the page:
</p>

<div class="org-src-container">
<pre class="src src-js">window.addEventListener<span style="color: #707183;">(</span><span style="color: #008000;">'scroll'</span>, <span style="color: #0000FF;">function</span><span style="color: #7388D6;">(</span><span style="color: #BA36A5;">event</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">{</span>
    <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">links</span> =
        document.querySelectorAll<span style="color: #909183;">(</span><span style="color: #008000;">'#text-table-of-contents a'</span><span style="color: #909183;">)</span>
    links.forEach<span style="color: #909183;">(</span><span style="color: #0000FF;">function</span><span style="color: #709870;">(</span><span style="color: #BA36A5;">link</span>, <span style="color: #BA36A5;">i</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
        <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">anchor</span> = link.getAttribute<span style="color: #907373;">(</span><span style="color: #008000;">'href'</span><span style="color: #907373;">)</span>
        <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">section</span> = document.querySelector<span style="color: #907373;">(</span>anchor<span style="color: #907373;">)</span>
        <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">sectionTop</span> = section.getBoundingClientRect<span style="color: #907373;">()</span>.top

        <span style="color: #0000FF;">if</span> <span style="color: #907373;">(</span>sectionTop - 10 &lt;= 0<span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
            <span style="color: #0000FF;">if</span> <span style="color: #6276BA;">(</span>i &gt; 0<span style="color: #6276BA;">)</span> links<span style="color: #6276BA;">[</span>i-1<span style="color: #6276BA;">]</span>.classList.remove<span style="color: #6276BA;">(</span><span style="color: #008000;">'active'</span><span style="color: #6276BA;">)</span>
            link.classList.add<span style="color: #6276BA;">(</span><span style="color: #008000;">'active'</span><span style="color: #6276BA;">)</span>
        <span style="color: #907373;">}</span> <span style="color: #0000FF;">else</span> <span style="color: #907373;">{</span>
            link.classList.remove<span style="color: #6276BA;">(</span><span style="color: #008000;">'active'</span><span style="color: #6276BA;">)</span>
        <span style="color: #907373;">}</span>
    <span style="color: #709870;">}</span><span style="color: #909183;">)</span>
<span style="color: #7388D6;">}</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
(The <code>.active</code> CSS class applies <code>rgb(255, 248, 212)</code> as the background and
<code>var(--select-color)</code> as the color.)
</p>

<p>
Converted to our extended CSS, this is what the equivalent could look like:
</p>

<div class="org-src-container">
<pre class="src src-css">#text-table-of-contents a<span style="color: #707183;">[</span>href=<span style="color: #008000;">"#"</span> $id<span style="color: #707183;">]</span>:last-match <span style="color: #707183;">{</span>
    <span style="color: #00AA00;">background</span>: <span style="color: #000000; background-color: #fff8d4;">rgb(255, 248, 212)</span>;
    <span style="color: #00AA00;">color</span>: var<span style="color: #7388D6;">(</span><span style="color: #BA36A5;">--select-color</span><span style="color: #7388D6;">)</span>;
<span style="color: #707183;">}</span> while <span style="color: #707183;">[</span>id=$id<span style="color: #707183;">]</span> <span style="color: #707183;">{</span> y-rel &lt;= 0; <span style="color: #707183;">}</span>.
</pre>
</div>

<p>
The syntax introduces a couple of things:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Example</th>
<th scope="col" class="org-left">Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>$id</code></td>
<td class="org-left"><b>Logic variables</b> &#x2013; that is, variables local to the current rule that are automatically unified without any explicit assignment by the programmer. Instead, the interpreter figures out from the information provided by the programmer what the value must be.</td>
</tr>

<tr>
<td class="org-left"><code>while ...</code></td>
<td class="org-left"><b>Conditions</b> &#x2013; terminated by a period.</td>
</tr>

<tr>
<td class="org-left"><code>y-rel &lt;= 0</code></td>
<td class="org-left"><b>Comparisons</b>. Also note the new property <b><code>y-rel</code></b>, denoting the element&rsquo;s current position on the <i>y</i> axis relative to the viewport.</td>
</tr>

<tr>
<td class="org-left"><code>[href="#" $id]</code></td>
<td class="org-left">Support for <b>concatenation</b> in attribute values &#x2013; with the same syntax as for property values.</td>
</tr>

<tr>
<td class="org-left"><code>:last-match</code></td>
<td class="org-left">A <b>new pseudo-class selector</b> selecting the last element matching the entire preceding selector. Compare this to <code>:last-of-type</code>, which only selects the last <i>sibling</i> of the same type.</td>
</tr>
</tbody>
</table>

<p>
The CSS rule above could be put into words in the following way. It applies to
the &ldquo;<code>:last-match</code>&rdquo; out of all <code>a</code> elements inside <code>#text-table-of-contents</code> whose
attribute <code>href</code> consists of the concatenation of <code>#</code> and some variable <code>$id</code> &#x2013; but
only <i>while</i> there exists any element whose id is <code>$id</code> and whose <i>y</i> position,
relative to the viewport, is less than or equal to 0.
</p>

<p>
Whenever the browser finds any elements matching the selector in our <code>while</code>
condition (that is, is an element that has an id and whose relative <i>y</i> position &le;
0), it will recognize that the <code>$id</code> variable can be equal to the id of either one
of those elements. For all possible values of <code>$id</code>, it will apply our rule &#x2013; but
remember, our rule concerns only the <i>last</i> match, so it will only be applied to
the last element. While you&rsquo;re reading this section, that element&rsquo;s <code>href</code> is
<code>#css-examples</code>.
</p>

<p>
The complete explanation might be a little long, as I also needed to introduce
the concepts behind the syntax, but the actual code is short and understandable,
once you have become comfortable with the interface. As demonstrated, it is
possible to achieve a whole lot, with only a limited number of additions to the
regular CSS syntax. What&rsquo;s more, the code is clearer than the equivalent
JavaScript code, and it is more declarative, describing <i>what</i> the designer wanted
and not <i>how</i> they wanted it.
</p>

<p>
Of course, simpler things would be simpler:
</p>

<div class="org-src-container">
<pre class="src src-css"><span style="color: #0000ff; font-weight: bold;">#nav .menu </span><span style="color: #707183;">{</span> <span style="color: #00AA00;">display</span>: none; <span style="color: #707183;">}</span> <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">default rule </span><span style="color: #8D8D84;">*/</span>
<span style="color: #0000ff; font-weight: bold;">#nav .menu </span><span style="color: #707183;">{</span> <span style="color: #00AA00;">display</span>: block; <span style="color: #707183;">}</span> toggled by #menu-button:active.
</pre>
</div>

<p>
In this example, we extend the syntax further with the <code>toggled by</code> condition.
Another plausible condition type would be <code>on</code>, which would enable the rule after
the condition has been met, but would not disable it once the condition ceases
to be met.
</p>
</div>
</div>
</div>


<div id="outline-container-orgaa71b80" class="outline-2">
<h2 id="orgaa71b80">Dynamic DOM manipulation</h2>
<div class="outline-text-2" id="text-orgaa71b80">
<p>
The combination of dynamic HTTP requests and CSS rules go a long way, but what
about implementing, say, WYSIWYG editors? They require more than simple CSS
styling &#x2013; they need to dynamically generate new HTML, preferably locally
without contacting any server.
</p>

<p>
Compared to the previous pieces of functionality, client-side HTML generation is
less obvious how to implement. Our proposed interface for dynamic HTTP requests,
based on <i>Intercooler</i>, deals with inserting <i>externally</i> generated HTML into the
current page, but perhaps the problem of <i>locally</i> generated HTML can be solved
within the same framework.
</p>

<p>
In order to narrow the scope of this article, I&rsquo;ll leave this question open &#x2013;
but, sooner or later, it will need an answer.
</p>
</div>
</div>


<div id="outline-container-org7d33139" class="outline-2">
<h2 id="org7d33139">In closing: <span class="heading-sub">   Reason for optimism </span>  </h2>
<div class="outline-text-2" id="text-org7d33139">
<p>
This article is already too long, but before I leave, I&rsquo;d like to say a few
words about the future. I&rsquo;m sure that this article sounds like a pipe dream &#x2013; a
utopic idea doomed to be rejected by the big internet firms that rely on
JavaScript as a means of tracking their users and controlling the web.
</p>

<p>
But there is reason for optimism, because even if we fail to kill JavaScript,
the worst thing that could happen is that these ideas result in an interface
that can be used as a user-friendly &#x2013; and developer-friendly! &#x2013; alternative to
traditional JavaScript.
</p>

<p>
That&rsquo;s not to say it is impossible to kill JavaScript. It doesn&rsquo;t need to happen
overnight, and it doesn&rsquo;t need to disappear everywhere &#x2013; it just needs to be
disabled by default, but for this to happen, we first need an alternative. If we
start working on a JavaScript implementation of this interface (or one like it),
released under a permissive free software license, piece by piece, we could
start using it on our own webpages, and people, especially those with <a href="https://www.gnu.org/software/librejs/">LibreJS</a>
installed, would already start to benefit.
</p>

<p>
To reiterate, I believe that a declarative interface like this, based on the
idea of user consent, would not only be benificial for the user, but also far
more pleasant for the developer to work with than what we currently have.
</p>


<div class="note">
<p>
Congratulations on making it all the way to the end!
</p>

<p>
If you enjoyed this article, please share it to spread its message. If you&rsquo;re
interested in contributing to the effort of making the web more pleasant both
for the user and for the developer, I&rsquo;d love to discuss the ideas with you on
Hacker News, Reddit or anywhere else you&rsquo;d like.
</p>

<p>
You can also contact me by e-mail at the following address:
<br /><code>my first name <b>at</b> my last name <b>dot</b> se</code>.
</p>

<p>
If you&rsquo;d like to use PGP, my public key is retrievable from the
<code>hkps://pgp.mailbox.org</code> keyserver. To find it, just search for my e-mail address.
</p>

<p>
Thank you for reading! <br /> &#x2013; John
</p>

</div>
</div>


<div id="outline-container-orgf21330d" class="outline-3">
<h3 id="orgf21330d">Changelog</h3>
<div class="outline-text-3" id="text-orgf21330d">
<p>
This article was last updated on January 12th. The title was changed to remove
the word &ldquo;kill&rdquo;, which sounded a bit harsh. The term &ldquo;dynamic HTML generation&rdquo;
was changed to &ldquo;dynamic DOM manipulation&rdquo;, which better expresses what I meant.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: January 12th, 2018</p>
<p class="author">Author: John AnkarstrÃ¶m</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
